<!DOCTYPE html>
<html lang="en">

<head>
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <!-- site metas -->
    <title>AV Shopping</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- bootstrap css -->
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}">
    <!-- style css -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <!-- Responsive-->
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
    <!-- fevicon -->
    <link rel="icon" href="{% static 'images/site-logo.png' %}" type="image/gif" />
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/jquery.mCustomScrollbar.min.css' %}">
    <!-- Tweaks for older IEs-->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <!-- fonts -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
    <!-- font awesome -->
    <link rel="stylesheet" type="text/css"
        href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--  -->
    <!-- owl stylesheets -->
    <link href="https://fonts.googleapis.com/css?family=Great+Vibes|Poppins:400,700&display=swap&subset=latin-ext"
        rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}">
    <link rel="stylesoeet" href="{% static 'css/owl.theme.default.min.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css"
        media="screen">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
        integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap1.css' %}" />
    <!-- font awesome style -->
    <link href="{% static 'css/font-awesome1.min.css' %}" rel="stylesheet" />
    <!-- Custom styles for this template -->
    <link href="{% static 'css/style1.css' %}" rel="stylesheet" />
    <!-- responsive style -->
    <link href="{% static 'css/responsive1.css' %}" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
</head>

<style>
    .text-center{
        font-weight: bold;
    }

    .product_section .box{
        border-radius: 25px;
        background-color: #ffffff;
        border: solid #fff8f8 10px;
    }

    .product_section .box .img-box img{
        max-width: 100%;
        max-height: 200px;
        transition: all .3s;
    }
</style>

<body>
    <!-- banner bg main start -->
    <div class="banner_bg_main">
        <!-- header top section start -->
        <div class="container">
            <div class="header_section_top">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="custom_menu">
                            <ul>
                                <li><a href="{% url 'shophome' %}">Home</a></li>
                                <li><a href="{% url 'my_orders' %}">My Order</a></li>
                                <li><a href="{% url 'tracker' %}">Tracker</a></li>
                                <li><a href="{% url 'about' %}">About</a></li>
                                <li><a href="{% url 'contact' %}">Contcat Us</a></li>
                                <div class="header_box">
                                    <div class="lang_box" id="google_translate_element"></div>
                                    <div class="login_menu">
                                        <button type="button" id="cart_btn" class="btn btn-light mx-3">Cart(<span
                                                id="cart_len">{{len_cart}}</span>)
                                        </button>
                                    </div>
                                </div>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- banner bg main end -->
    <!-- product section -->

    <section class="product_section layout_padding">
        <div class="container">
            <div class="row">
                <div class="heading_container heading_center">
                    <h2>
                        <span>Your search results </span>
                    </h2>
                    <p id="query" hidden</p>
                </div>
                {% for product in allprods %}
                <div class="col-sm-6 col-md-4 col-lg-4">
                    <div class="box">
                        <div class="option_container">
                            <div class="options">
                                <a href="productview/{{product.id}}" class="option1">
                                    View
                                </a>
                                {% if user.is_authenticated %}
                                {% if product.name in cart_items_list %}
                                <a class="btn btn-primary disabled btn-sm" style="color:white;">Added to Cart</a>
                                {% else %}
                                <a id="pr{{product.id}}" class="btn btn-primary btn-sm cart" style="color: white;"
                                    data-id="{{product.id}}">Add to Cart</a>
                                {% endif %}
                                {% else %}
                                <a id="pr{{product.id}}" class="btn btn-primary btn-sm no_cart" style="color: white;"
                                    data-id="{{product.id}}">Add to Cart</a>
                                {% endif %}
                            </div>
                        </div>
                        <div class="img-box">
                            <img class="p_img" src="/media/{{product.image}}" alt="">
                        </div>
                        <div class="detail-box">
                            <h5 id="name">
                                {{product.name|slice:"0:15"}}
                            </h5>
                            <p id="namepr{{product.id}}" hidden>{{product.name}}</p>
                            <h6>
                                Rs. <span id="pricepr{{product.id}}">{{product.price}}</span>
                            </h6>
                        </div>
                        <div class="text-center">
                            <!-- <h6 align="center">
                                <b style="color: rgb(0, 27, 80);">{{product.discount}}% off</b>
                            </h6> -->
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    <form method="post">
        {% csrf_token %}
    </form>

    <!-- end product section -->
    <!-- Javascript files-->
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/popper.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'js/jquery-3.0.0.min.js' %}"></script>
    <script src="{% static 'js/plugin.js' %}"></script>
    <!-- sidebar -->
    <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="{% static 'js/custom.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <script type="text/javascript"
        src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <script>
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({ pageLanguage: 'en' }, 'google_translate_element');
        }
        function openNav() {
            document.getElementById("mySidenav").style.width = "250px";
        }

        function closeNav() {
            document.getElementById("mySidenav").style.width = "0";
        }
    </script>
</body>

</html>
<script>
    if("{{allprods_len}}" == 0){
        $('#query').replaceWith('<p class="text-center my-5" style="font-size:45px"><b>No results for "{{query}}".</b></p><p class="text-center" style="font-size:40px"><b>Try checking your spelling or use more general terms.</b></p>');
    }
    $('.no_cart').on('click', function () {
        toastr.info('Please sign in to your account for use cart!')
        $('.toast').css('background-color', '#2f96b4');
    })
    $('#cart_btn').on('click', function () {
        if ($('#cart_len').text() > 0) {
            window.location = '/cart';
        }
        else {
            toastr.info('Your cart is empty, Please add some items in your cart!');
        }
    });

    function reload() {
        window.location = '/';
    }


    $('.cart').on('click', function () {
        let self = $(this);
        let product_id = self.attr('data-id');
        data = {
            'product_id': product_id,
            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
        }
        $.ajax({
            type: 'POST',
            url: "{% url 'shophome' %}",
            data: data,
            success: function (data) {
                if (data.success == 'Item added to cart.') {
                    $('#cart_len').text(data.len_cart);
                    toastr.success(data.success);
                    self.removeClass('cart');
                    self.text('Added to Cart');
                    self.addClass("disabled");

                }
                else {
                    toastr.success(data.error);
                }
            }
        })
    })

</script>